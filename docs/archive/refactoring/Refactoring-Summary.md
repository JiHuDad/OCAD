# OCAD λ¦¬ν©ν† λ§ μ”μ•½

## μ™„λ£λ μ‘μ—…

### 1. λ¬Έμ μ  λ¶„μ„ λ° λ¦¬ν©ν† λ§ κ³„ν μλ¦½

**λ¬Έμ„**: [Refactoring-Plan.md](Refactoring-Plan.md)

**μ£Όμ” λ¬Έμ μ  νμ•…:**
- β ν•™μµ μ½”λ“μ™€ μ΄μ μ½”λ“κ°€ μ„μ—¬ μμ
- β λ°μ΄ν„° κµν™ μΈν„°νμ΄μ¤ λ…μ„Έ λ¶€μ¬
- β ν΄λ” κµ¬μ΅°κ°€ λ…ν™•ν•μ§€ μ•μ
- β μ™Έλ¶€ μ‹μ¤ν…κ³Όμ ν†µν•© μ–΄λ ¤μ›€

### 2. λ°μ΄ν„° μΈν„°νμ΄μ¤ λ…μ„Έ μ‘μ„±

**λ¬Έμ„**: [Data-Interface-Specification.md](Data-Interface-Specification.md)

**μ£Όμ” λ‚΄μ©:**
- β… λ©”νΈλ¦­ λ°μ΄ν„° μ¤ν‚¤λ§ (Ingress)
- β… μ•λ λ°μ΄ν„° μ¤ν‚¤λ§ (Egress)
- β… REST API λ…μ„Έ
- β… Kafka ν† ν”½ μ„¤κ³„
- β… νμΌ κΈ°λ° λ°μ΄ν„° κµν™ (CSV, Parquet)
- β… μ—λ¬ μ²λ¦¬ λ° λ²„μ „ κ΄€λ¦¬

### 3. Phase A: λ°μ΄ν„° μΈν„°νμ΄μ¤ κµ¬ν„

#### 3.1 λ°μ΄ν„° μ¤ν‚¤λ§ κµ¬ν„

**νμΌ**: [ocad/core/schemas.py](../ocad/core/schemas.py)

**κµ¬ν„ λ‚΄μ©:**
- Pydantic κΈ°λ° λ°μ΄ν„° κ²€μ¦
- λ©”νΈλ¦­ λ°μ΄ν„° μ¤ν‚¤λ§ (`MetricData`, `MetricBatch`)
- μ•λ λ°μ΄ν„° μ¤ν‚¤λ§ (`AlertData`)
- API μ‘λ‹µ μ¤ν‚¤λ§ (`APIResponse`, `ErrorResponse`)

**μ£Όμ” κΈ°λ¥:**
```python
class MetricData(BaseModel):
    """λ©”νΈλ¦­ λ°μ΄ν„° μ¤ν‚¤λ§ v1.0.0"""
    schema_version: str = "1.0.0"
    endpoint_id: str
    timestamp: int
    metric_type: MetricType  # Enum κ²€μ¦
    value: float
    unit: MetricUnit
    labels: Optional[Dict[str, str]]
    quality: Optional[MetricQuality]

    # μλ™ κ²€μ¦
    @validator('timestamp')
    def validate_timestamp(cls, v):
        # κ³Όκ±° 1λ…„ ~ λ―Έλ 1μ‹κ°„ λ²”μ„ κ²€μ¦
        ...
```

#### 3.2 REST API μ—”λ“ν¬μΈνΈ κµ¬ν„

**νμΌ**:
- [ocad/api/v1/metrics.py](../ocad/api/v1/metrics.py)
- [ocad/api/v1/alerts.py](../ocad/api/v1/alerts.py)

**μƒλ΅μ΄ API μ—”λ“ν¬μΈνΈ:**

**λ©”νΈλ¦­ μμ§‘ (Ingress):**
```
POST   /api/v1/metrics/                # λ‹¨μΌ λ©”νΈλ¦­ μ „μ†΅
POST   /api/v1/metrics/batch           # λ°°μΉ λ©”νΈλ¦­ μ „μ†΅
POST   /api/v1/metrics/upload/csv      # CSV νμΌ μ—…λ΅λ“
GET    /api/v1/metrics/                # λ©”νΈλ¦­ μ΅°ν
```

**μ•λ κ΄€λ¦¬ (Egress):**
```
GET    /api/v1/alerts/                 # μ•λ λ©λ΅
GET    /api/v1/alerts/{id}             # μ•λ μƒμ„Έ
POST   /api/v1/alerts/{id}/acknowledge # μ•λ ν™•μΈ
POST   /api/v1/alerts/{id}/resolve     # μ•λ ν•΄κ²°
GET    /api/v1/alerts/stats/summary    # μ•λ ν†µκ³„
```

#### 3.3 ν…μ¤νΈ μ¤ν¬λ¦½νΈ μ‘μ„±

**νμΌ**: [scripts/test_data_interface.py](../scripts/test_data_interface.py)

**ν…μ¤νΈ ν•­λ©:**
- β… λ‹¨μΌ λ©”νΈλ¦­ μ „μ†΅
- β… λ°°μΉ λ©”νΈλ¦­ μ „μ†΅
- β… λ©”νΈλ¦­ μ΅°ν
- β… λ°μ΄ν„° κ²€μ¦ (μλ»λ λ°μ΄ν„°)
- β… μ•λ ν†µκ³„ μ΅°ν

## μ‚¬μ© λ°©λ²•

### 1. API μ„λ²„ μ‹¤ν–‰

```bash
# κ°€μƒν™κ²½ ν™μ„±ν™”
source .venv/bin/activate

# API μ„λ²„ μ‹μ‘
python -m ocad.api.main

# μ¶λ ¥:
# INFO:     Started server process
# INFO:     Uvicorn running on http://0.0.0.0:8080 (Press CTRL+C to quit)
```

### 2. API λ¬Έμ„ ν™•μΈ

λΈλΌμ°μ €μ—μ„ λ‹¤μ URLλ΅ μ ‘μ†:
- Swagger UI: http://localhost:8080/api/docs
- ReDoc: http://localhost:8080/api/redoc
- OpenAPI JSON: http://localhost:8080/api/openapi.json

### 3. λ©”νΈλ¦­ μ „μ†΅ μμ‹

**Python:**
```python
import requests
import time

metric = {
    "endpoint_id": "o-ru-001",
    "timestamp": int(time.time() * 1000),
    "metric_type": "udp_echo_rtt",
    "value": 5.2,
    "unit": "ms"
}

response = requests.post(
    "http://localhost:8080/api/v1/metrics/",
    json=metric
)

print(response.json())
# {'status': 'accepted', 'metric_id': 'met_abc123', 'received_at': 1729584000100}
```

**cURL:**
```bash
curl -X POST "http://localhost:8080/api/v1/metrics/" \
  -H "Content-Type: application/json" \
  -d '{
    "endpoint_id": "o-ru-001",
    "timestamp": 1729584000000,
    "metric_type": "udp_echo_rtt",
    "value": 5.2,
    "unit": "ms"
  }'
```

### 4. ν…μ¤νΈ μ‹¤ν–‰

```bash
# API μ„λ²„κ°€ μ‹¤ν–‰ μ¤‘μΈ μƒνƒμ—μ„
python scripts/test_data_interface.py
```

**μμƒ μ¶λ ¥:**
```
============================================================
OCAD λ°μ΄ν„° μΈν„°νμ΄μ¤ ν…μ¤νΈ
============================================================

λ‹¨μΌ λ©”νΈλ¦­ μ „μ†΅ ν…μ¤νΈ
β… μ„±κ³µ!
  metric_id: met_abc123

λ°°μΉ λ©”νΈλ¦­ μ „μ†΅ ν…μ¤νΈ
β… μ„±κ³µ!
  accepted: 10

============================================================
ν…μ¤νΈ κ²°κ³Ό μ”μ•½
============================================================
λ‹¨μΌ λ©”νΈλ¦­ μ „μ†΅                 β… ν†µκ³Ό
λ°°μΉ λ©”νΈλ¦­ μ „μ†΅                 β… ν†µκ³Ό
λ©”νΈλ¦­ μ΅°ν                     β… ν†µκ³Ό
μλ»λ λ©”νΈλ¦­ κ²€μ¦               β… ν†µκ³Ό
μ•λ ν†µκ³„ μ΅°ν                   β… ν†µκ³Ό

μ΄ 5κ° ν…μ¤νΈ
ν†µκ³Ό: 5κ°
μ‹¤ν¨: 0κ°
```

## κ°μ„  μ‚¬ν•­

### Before (κΈ°μ΅΄)

```
μ™Έλ¶€ μ‹μ¤ν… β†’ ??? β†’ OCAD
- λ…μ„Έ μ—†μ
- κ²€μ¦ μ—†μ
- λ²„μ „ κ΄€λ¦¬ μ—†μ
```

### After (κ°μ„ )

```
μ™Έλ¶€ μ‹μ¤ν… β†’ [REST API/Kafka] β†’ OCAD
              β†‘
              - λ…ν™•ν• μ¤ν‚¤λ§ (Pydantic)
              - μλ™ κ²€μ¦
              - λ²„μ „ κ΄€λ¦¬ (v1.0.0)
              - OpenAPI λ¬Έμ„
```

**μ£Όμ” κ°μ„ μ :**

1. **ν‘μ¤€ν™”λ λ°μ΄ν„° ν¬λ§·**
   - JSON Schema κΈ°λ° κ²€μ¦
   - λ…ν™•ν• ν•„λ“ μ •μ
   - νƒ€μ… μ•μ „μ„±

2. **μλ™ κ²€μ¦**
   - Pydantic μλ™ κ²€μ¦
   - νƒ€μ„μ¤νƒ¬ν”„ λ²”μ„ κ²€μ¦
   - ν•„λ“ κΈΈμ΄ μ ν•

3. **λ¬Έμ„ν™”**
   - OpenAPI μλ™ μƒμ„±
   - Swagger UI μ κ³µ
   - μμ  μ½”λ“ μ κ³µ

4. **μ—λ¬ μ²λ¦¬**
   - ν‘μ¤€ μ—λ¬ μ‘λ‹µ ν¬λ§·
   - λ…ν™•ν• μ—λ¬ μ½”λ“
   - λ””λ²„κΉ… μ •λ³΄ μ κ³µ

5. **λ²„μ „ κ΄€λ¦¬**
   - API λ²„μ „ (v1, v2)
   - μ¤ν‚¤λ§ λ²„μ „ (1.0.0)
   - ν•μ„ νΈν™μ„± λ³΄μ¥

## μƒμ„±λ νμΌ λ©λ΅

```
docs/
β”β”€β”€ Refactoring-Plan.md                    # λ¦¬ν©ν† λ§ κ³„ν (μ „μ²΄)
β”β”€β”€ Data-Interface-Specification.md        # λ°μ΄ν„° μΈν„°νμ΄μ¤ λ…μ„Έ
β””β”€β”€ Refactoring-Summary.md                 # μ΄ λ¬Έμ„

ocad/
β”β”€β”€ core/
β”‚   β””β”€β”€ schemas.py                         # λ°μ΄ν„° μ¤ν‚¤λ§ (NEW)
β””β”€β”€ api/
    β”β”€β”€ main.py                            # μ—…λ°μ΄νΈ (v1 λΌμ°ν„° μ¶”κ°€)
    β””β”€β”€ v1/                                # NEW
        β”β”€β”€ __init__.py
        β”β”€β”€ metrics.py                     # λ©”νΈλ¦­ API
        β””β”€β”€ alerts.py                      # μ•λ API

scripts/
β””β”€β”€ test_data_interface.py                 # API ν…μ¤νΈ μ¤ν¬λ¦½νΈ (NEW)
```

## μ¶”κ°€ μ™„λ£: Phase 0 - νμΌ κΈ°λ° λ°μ΄ν„° μ…λ ¥ (2025-10-23)

### λ°°κ²½

REST APIλ¥Ό λ¨Όμ € κµ¬ν„ν–μ§€λ§, μ‹¤μ  μ΄μ ν™κ²½μ—μ„λ” CFM λ‹΄λ‹Ήμκ°€ μ–΄λ–¤ λ°μ΄ν„°λ¥Ό μμ§‘ν•  μ μλ”μ§€ λ¨Όμ € ν™•μΈν•΄μ•Ό ν–μµλ‹λ‹¤. λ”°λΌμ„ **νμΌ κΈ°λ° μ…λ ¥**μ„ λ¨Όμ € κµ¬ν„ν•μ—¬ μ”κµ¬μ‚¬ν•­μ„ λ…ν™•ν ν•κΈ°λ΅ κ²°μ •ν–μµλ‹λ‹¤.

### κµ¬ν„ λ‚΄μ©

**νμΌ λ΅λ”** (`ocad/loaders/`):
- `CSVLoader`: CSV νμΌ λ΅λ” (Wide/Long μλ™ κ°μ§€)
- `ExcelLoader`: Excel νμΌ λ΅λ” (λ‹¤μ¤‘ Sheet μ§€μ›)
- `ParquetLoader`: Parquet νμΌ λ΅λ” (κ³ μ„±λ¥)
- `FormatConverter`: νμΌ ν•μ‹ λ³€ν™ (CSV β†” Parquet, Wide β†” Long)

**μƒν” λ°μ΄ν„°**:
- `sample_oran_metrics.xlsx`: CFM λ‹΄λ‹Ήμμ© Excel (3 sheets)
- `sample_oran_metrics_wide.csv`: Wide Format CSV
- `sample_oran_metrics_long.csv`: Long Format CSV

**ν…μ¤νΈ**: 6κ° ν…μ¤νΈ λ¨λ‘ ν†µκ³Ό β…

**μƒμ„Έ λ¬Έμ„**: [File-Based-Input-Implementation-Summary.md](File-Based-Input-Implementation-Summary.md)

---

## λ‹¤μ λ‹¨κ³„ (μ—…λ°μ΄νΈλ¨)

### μ¦‰μ‹ μν–‰ (μ΄λ² μ£Ό)

1. **CFM λ‹΄λ‹Ήμμ™€ ν‘μ**
   - [ ] λ―Έν… μΌμ • μ΅κΈ°
   - [ ] Excel μƒν” λ° μ”κµ¬μ‚¬ν•­ λ¬Έμ„ μ „λ‹¬
   - [ ] λ°μ΄ν„° μμ§‘ κ°€λ¥ μ—¬λ¶€ ν™•μΈ

2. **μƒν” λ°μ΄ν„° μ¶”κ°€ μƒμ„±**
   - [x] Excel μƒν” (3 sheets)
   - [x] CSV Wide/Long Format
   - [ ] λ” λ§μ€ μ‹λ‚λ¦¬μ¤λ³„ μƒν” μƒμ„±

### Phase B: νμΌ λ΅λ” ν†µν•© (1-2μ£Ό)

**μ°μ„ μμ„**: λ†’μ (CFM ν”Όλ“λ°± λ°›μ€ ν›„)

1. **νμΌ λ΅λ” νμ΄ν”„λΌμΈ ν†µν•©**
   - SystemOrchestratorμ— νμΌ λ΅λ” μ—°λ™
   - λ°°μΉ μ²λ¦¬ μ¤μΌ€μ¤„λ¬ κµ¬ν„
   - μλ™ νμΌ κ°μ‹ (watchdog)

2. **λ°μ΄ν„° κ²€μ¦ κ°•ν™”**
   - μμ§‘ κ°€λ¥ν• ν•„λ“λ΅ μ¤ν‚¤λ§ μ΅°μ •
   - μ—λ¬ μ²λ¦¬ λ° λ³µκµ¬

### Phase C: ν΄λ” κµ¬μ΅° λ¦¬ν©ν† λ§ (μ„ νƒ)

**μ°μ„ μμ„**: μ¤‘κ°„

ν„μ¬ κµ¬μ΅°λ΅λ„ μ¶©λ¶„ν•μ§€λ§, ν•„μ” μ‹:

1. **ν•™μµ/μ΄μ μ½”λ“ λ” λ…ν™•ν• λ¶„λ¦¬**
   - `training/` μ™„μ „ λ…λ¦½
   - μμ΅΄μ„± μµμ†ν™”

2. **ν…μ¤νΈ κµ¬μ΅° μ •λ¦¬**
   - μ†μ¤ μ½”λ“μ™€ μΌμΉν•λ” ν…μ¤νΈ κµ¬μ΅°

### Phase D: μ‹¤μ‹κ°„ μΈν„°νμ΄μ¤ (μ„ νƒ, CFM ν‘μ ν›„)

**μ°μ„ μμ„**: λ‚®μ (νμΌ μ…λ ¥μΌλ΅ μ¶©λ¶„ν•  μ μμ)

1. **REST API λ°°ν¬** (κµ¬ν„λ¨, λ°°ν¬λ§ ν•„μ”)
   - Phase Aμ—μ„ μ΄λ―Έ κµ¬ν„ μ™„λ£
   - CFMμ—μ„ μ‹¤μ‹κ°„ μ „μ†΅ κ°€λ¥ν•λ©΄ ν™μ„±ν™”

2. **Kafka ν†µν•©** (ν•„μ” μ‹)
   - λ©”νΈλ¦­ μ¤νΈλ¦¬λ°
   - μ•λ λ°ν–‰

3. **WebSocket** (ν•„μ” μ‹)
   - μ‹¤μ‹κ°„ λ€μ‹λ³΄λ“
   - ν‘Έμ‹ μ•λ

### Phase E: λ¨λΈ λ μ§€μ¤νΈλ¦¬ (λ―Έμ •)

**μ°μ„ μμ„**: λ‚®μ

ν„μ¬ νμΌ κΈ°λ° λ¨λΈ κ΄€λ¦¬λ΅ μ¶©λ¶„. λ¨λΈ μκ°€ λ§μ•„μ§€λ©΄ κ³ λ ¤.

---

## ν„μ¬ μƒνƒ μ”μ•½

### β… μ™„λ£

1. **Phase A: λ°μ΄ν„° μΈν„°νμ΄μ¤**
   - Pydantic μ¤ν‚¤λ§ μ •μ
   - REST API κµ¬ν„ (λ°°ν¬ μ—°κΈ°)
   - OpenAPI λ¬Έμ„ μλ™ μƒμ„±

2. **Phase 0: νμΌ κΈ°λ° μ…λ ¥**
   - CSV/Excel/Parquet λ΅λ”
   - νμΌ ν•μ‹ λ³€ν™κΈ°
   - μƒν” λ°μ΄ν„° μƒμ„±
   - CFM μ”κµ¬μ‚¬ν•­ λ¬Έμ„

3. **κΈ°νƒ€**
   - ν•™μµ-μ¶”λ΅  λ¶„λ¦¬ μ™„λ£
   - TCN λ¨λΈ ν•™μµ νμ΄ν”„λΌμΈ
   - Pydantic v2 λ§μ΄κ·Έλ μ΄μ…

### π”„ μ§„ν–‰ μ¤‘

- CFM λ‹΄λ‹Ήμ ν‘μ μ¤€λΉ„
- μ¶”κ°€ μƒν” λ°μ΄ν„° μƒμ„±

### π“‹ λ€κΈ° μ¤‘

- νμΌ λ΅λ” νμ΄ν”„λΌμΈ ν†µν•© (CFM ν”Όλ“λ°± λ€κΈ°)
- REST API λ°°ν¬ (ν•„μ” μ‹)
- Kafka/WebSocket (ν•„μ” μ‹)

---

## κ²°λ΅ 

**ν‘μ¤€ν™”λ λ°μ΄ν„° μΈν„°νμ΄μ¤**μ™€ **μ‹¤μ©μ μΈ νμΌ κΈ°λ° μ…λ ¥**μ„ μ„±κ³µμ μΌλ΅ κµ¬ν„ν–μµλ‹λ‹¤:

β… **λ…ν™•ν• λ°μ΄ν„° κ³„μ•½** - μ™Έλ¶€ μ‹μ¤ν…κ³Όμ ν†µν•©μ΄ λ…ν™•ν•΄μ§
β… **μλ™ κ²€μ¦** - Pydanticμ„ ν†µν• λ°μ΄ν„° ν’μ§ λ³΄μ¥
β… **λ¬Έμ„ν™”** - OpenAPI/Swagger, CFM μ”κµ¬μ‚¬ν•­ λ¬Έμ„
β… **ν…μ¤νΈ κ°€λ¥** - 6κ° ν…μ¤νΈ λ¨λ‘ ν†µκ³Ό
β… **ν™•μ¥ κ°€λ¥** - νμΌ β†’ REST API β†’ Kafka μ μ§„μ  ν™•μ¥ κ°€λ¥
β… **μ‹¤μ©μ  μ ‘κ·Ό** - νμΌλ΅ λ¨Όμ € κ²€μ¦ ν›„ μ‹¤μ‹κ°„ μΈν„°νμ΄μ¤ κµ¬μ¶•

**ν•µμ‹¬ μ „λµ λ³€κ²½:**
- λ€κ·λ¨ λ¦¬ν©ν† λ§ β†’ μ μ§„μ , μ‹¤μ©μ  μ ‘κ·Ό
- λ¨λ“  μΈν„°νμ΄μ¤ κµ¬ν„ β†’ νμΌ κΈ°λ°μΌλ΅ μ”κµ¬μ‚¬ν•­ ν™•μ • ν›„ ν™•μ¥
- μ‚¬μ „ μ„¤κ³„ β†’ μ‹¤μ  λ°μ΄ν„°λ΅ κ²€μ¦ ν›„ μ‹μ¤ν… μ΅°μ • (YAGNI)

μ΄μ  OCADλ” **μ μ—°ν•κ³  μ‹¤μ©μ μΈ λ°©μ‹**μΌλ΅ λ°μ΄ν„°λ¥Ό κµν™ν•  μ μμµλ‹λ‹¤!

---

**μµμΆ… μ—…λ°μ΄νΈ**: 2025-10-23
**μ‘μ„±μ**: Claude Code
**Phase**: A (μ™„λ£) + 0 (μ™„λ£)
**μƒνƒ**: β… νμΌ κΈ°λ° μ…λ ¥ μ™„λ£, CFM ν‘μ λ€κΈ° μ¤‘
