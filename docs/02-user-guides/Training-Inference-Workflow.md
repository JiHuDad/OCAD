# í•™ìŠµ-ì¶”ë¡  ì›Œí¬í”Œë¡œìš° ê°€ì´ë“œ

**ë‚ ì§œ**: 2025-10-23
**ëŒ€ìƒ**: OCAD ì´ìƒ íƒì§€ ëª¨ë¸ í•™ìŠµ ë° ì¶”ë¡ 

## ëª©ì°¨

1. [ì´ìƒ íƒì§€ ê°œë…](#ì´ìƒ-íƒì§€-ê°œë…)
2. [ë°ì´í„° ìƒì„±](#ë°ì´í„°-ìƒì„±)
3. [ëª¨ë¸ í•™ìŠµ](#ëª¨ë¸-í•™ìŠµ)
4. [ì¶”ë¡  í…ŒìŠ¤íŠ¸](#ì¶”ë¡ -í…ŒìŠ¤íŠ¸)
5. [ê²°ê³¼ ë¶„ì„](#ê²°ê³¼-ë¶„ì„)

---

## ì´ìƒ íƒì§€ ê°œë…

### í•µì‹¬ ì›ë¦¬

**ì´ìƒ íƒì§€ëŠ” ì •ìƒ ë°ì´í„°ë¡œë§Œ í•™ìŠµí•©ë‹ˆë‹¤!**

```
í•™ìŠµ ë°ì´í„°:  ì •ìƒ íŒ¨í„´ë§Œ âœ…
           (ì´ìƒ ë°ì´í„° âŒ)

ì¶”ë¡  ë°ì´í„°:  ì •ìƒ + ì´ìƒ ëª¨ë‘ í…ŒìŠ¤íŠ¸ âœ“
```

### ì™œ ì •ìƒ ë°ì´í„°ë¡œë§Œ í•™ìŠµí•˜ë‚˜ìš”?

1. **ì •ìƒ íŒ¨í„´ í•™ìŠµ**: ëª¨ë¸ì´ "ì •ìƒ"ì´ ë¬´ì—‡ì¸ì§€ í•™ìŠµ
2. **ì´ìƒì€ ì˜ˆì¸¡ ë¶ˆê°€**: ì–´ë–¤ ì¢…ë¥˜ì˜ ì´ìƒì´ ë°œìƒí• ì§€ ëª¨ë¦„
3. **ì¼ë°˜í™”**: í•™ìŠµ ì‹œ ë³´ì§€ ëª»í•œ ìƒˆë¡œìš´ ì´ìƒë„ íƒì§€ ê°€ëŠ¥

### íƒì§€ ë°©ì‹

```
ì…ë ¥ ë°ì´í„° â†’ ëª¨ë¸ â†’ ì˜ˆì¸¡ê°’
                â†“
        ì˜ˆì¸¡ê°’ vs ì‹¤ì œê°’ ë¹„êµ
                â†“
          ì”ì°¨(residual) ê³„ì‚°
                â†“
    ì”ì°¨ê°€ í¬ë©´ â†’ ì´ìƒ âš ï¸
    ì”ì°¨ê°€ ì‘ìœ¼ë©´ â†’ ì •ìƒ âœ…
```

---

## ë°ì´í„° ìƒì„±

### 1. ë°ì´í„° ìƒì„± ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰

```bash
python scripts/generate_training_inference_data.py
```

### 2. ìƒì„±ë˜ëŠ” íŒŒì¼

#### í•™ìŠµ ë°ì´í„° (ì •ìƒë§Œ)

**íŒŒì¼**: `data/training_normal_only.csv`
- **ìš©ë„**: ëª¨ë¸ í•™ìŠµ
- **ë‚´ìš©**: ì •ìƒ ë°ì´í„°ë§Œ (28,800ê°œ)
- **íŠ¹ì§•**:
  - 5ê°œ ì—”ë“œí¬ì¸íŠ¸
  - 48ì‹œê°„ ë¶„ëŸ‰
  - 30ì´ˆ ê°„ê²©
  - ì¼ì¼ ì£¼ê¸° íŒ¨í„´ í¬í•¨ (ì•¼ê°„/ì£¼ê°„ ë³€ë™)

**ìƒ˜í”Œ**:
```csv
timestamp,endpoint_id,site_name,zone,udp_echo_rtt_ms,ecpri_delay_us,lbm_rtt_ms,lbm_success,ccm_interval_ms,ccm_miss_count,label
2025-10-01 00:00:00,o-ru-001,Tower-A,Urban,4.98,99.23,6.95,True,1000,0,normal
2025-10-01 00:00:30,o-ru-001,Tower-A,Urban,5.12,101.45,7.08,True,1000,0,normal
...
```

#### ì¶”ë¡  í…ŒìŠ¤íŠ¸ ë°ì´í„° (ì •ìƒ + ë¹„ì •ìƒ)

**íŒŒì¼**: `data/inference_test_scenarios.csv`
- **ìš©ë„**: ì¶”ë¡  í…ŒìŠ¤íŠ¸
- **ë‚´ìš©**: ì •ìƒ + ë¹„ì •ìƒ (780ê°œ)
- **ì‹œë‚˜ë¦¬ì˜¤**:
  1. ì •ìƒ ìš´ì˜ (180ê°œ) - ì •ìƒ âœ…
  2. Drift (180ê°œ) - ì ì§„ì  ì¦ê°€ âš ï¸
  3. Spike (120ê°œ) - ì¼ì‹œì  ê¸‰ì¦ âš ï¸
  4. Jitter (120ê°œ) - ë¶ˆê·œì¹™ ë³€ë™ âš ï¸
  5. ë³µí•© ì¥ì•  (90ê°œ) - ì—¬ëŸ¬ ë©”íŠ¸ë¦­ ë™ì‹œ ì´ìƒ ğŸš¨
  6. ì •ìƒ ë³µêµ¬ (90ê°œ) - ë³µêµ¬ í›„ ì •ìƒ âœ…

**ë¼ë²¨ ë¶„í¬**:
- `normal`: 478ê°œ (61.3%)
- `anomaly`: 302ê°œ (38.7%)

---

## ëª¨ë¸ í•™ìŠµ

### ì‚¬ìš© ê°€ëŠ¥í•œ ë°©ë²•

#### ë°©ë²• 1: ê¸°ì¡´ í•™ìŠµ ìŠ¤í¬ë¦½íŠ¸ (TCN)

```bash
# TCN ëª¨ë¸ í•™ìŠµ
python scripts/train_tcn_model.py \
    --metric-type udp_echo \
    --data-path data/training/normal_data.parquet \
    --epochs 50 \
    --batch-size 32
```

**ì¶œë ¥**:
- í•™ìŠµëœ ëª¨ë¸: `ocad/models/tcn/udp_echo_v1.0.0.pth`
- ë©”íƒ€ë°ì´í„°: `ocad/models/metadata/udp_echo_v1.0.0.json`

#### ë°©ë²• 2: ì „ì²´ í•™ìŠµ ìŠ¤í¬ë¦½íŠ¸

```bash
# ëª¨ë“  ë©”íŠ¸ë¦­ì— ëŒ€í•´ í•™ìŠµ
./scripts/train_all_models.sh
```

**ìƒì„±ë˜ëŠ” ëª¨ë¸**:
- `udp_echo_v1.0.0.pth`
- `ecpri_v1.0.0.pth`
- `lbm_v1.0.0.pth`

### í•™ìŠµ íŒŒë¼ë¯¸í„°

| íŒŒë¼ë¯¸í„° | ê¸°ë³¸ê°’ | ì„¤ëª… |
|---------|--------|------|
| `--epochs` | 50 | í•™ìŠµ ì—í­ ìˆ˜ |
| `--batch-size` | 32 | ë°°ì¹˜ í¬ê¸° |
| `--learning-rate` | 0.001 | í•™ìŠµë¥  |
| `--sequence-length` | 60 | ì‹œí€€ìŠ¤ ê¸¸ì´ |
| `--hidden-dim` | 64 | ì€ë‹‰ì¸µ ì°¨ì› |

### í•™ìŠµ ì‹œê°„

| ë°ì´í„° í¬ê¸° | ì˜ˆìƒ ì‹œê°„ |
|------------|----------|
| 10,000ê°œ | ~2ë¶„ |
| 30,000ê°œ | ~5ë¶„ |
| 100,000ê°œ | ~15ë¶„ |

---

## ì¶”ë¡  í…ŒìŠ¤íŠ¸

### 1. ì¶”ë¡  í…ŒìŠ¤íŠ¸ ì‹¤í–‰

```bash
python scripts/test_inference.py
```

### 2. ì‚¬ìš©ë˜ëŠ” íƒì§€ê¸°

OCADëŠ” **í•˜ì´ë¸Œë¦¬ë“œ íƒì§€** ë°©ì‹ì„ ì‚¬ìš©í•©ë‹ˆë‹¤:

| íƒì§€ê¸° | ë°©ì‹ | ì„¤ëª… |
|-------|------|------|
| **Rule-based** | ì„ê³„ê°’ | ì„¤ì •ëœ ì„ê³„ê°’ ì´ˆê³¼ ì—¬ë¶€ í™•ì¸ |
| **Changepoint** | CUSUM | ê¸‰ê²©í•œ ë³€í™”ì  íƒì§€ |
| **Residual (TCN)** | ì˜ˆì¸¡-ì”ì°¨ | ì •ìƒ íŒ¨í„´ ì˜ˆì¸¡ í›„ ì”ì°¨ ê³„ì‚° |

**ì¢…í•© ì ìˆ˜** = ê° íƒì§€ê¸° ì ìˆ˜ì˜ í‰ê· 

### 3. ì¶œë ¥ ì˜ˆì‹œ

```
======================================================================
ì¶”ë¡  ê²°ê³¼ í‰ê°€
======================================================================

ì „ì²´ ì •í™•ë„: 85.64%

Confusion Matrix:
ì˜ˆì¸¡         anomaly  normal
ì‹¤ì œ
anomaly         245      57
normal           55     423

í´ë˜ìŠ¤ë³„ ì •í™•ë„:
  normal  : 88.49% (423/478)
  anomaly : 81.13% (245/302)

ì‹œë‚˜ë¦¬ì˜¤ë³„ ì •í™•ë„:
  Drift (ì ì§„ì  ì¦ê°€)          :  95.6% (180ê°œ)
  Jitter (ë¶ˆì•ˆì •)             :  73.3% (120ê°œ)
  Spike (ì¼ì‹œì  ê¸‰ì¦)          :  80.0% (120ê°œ)
  ë³µí•© ì¥ì•  (Multi-metric)    : 100.0% (90ê°œ)
  ì •ìƒ ë³µêµ¬                   :  88.9% (90ê°œ)
  ì •ìƒ ìš´ì˜                   :  90.0% (180ê°œ)

íƒì§€ê¸°ë³„ í‰ê·  ì ìˆ˜:
  rule_based     : ì •ìƒ 0.125, ì´ìƒ 0.782
  changepoint    : ì •ìƒ 0.089, ì´ìƒ 0.654
  residual       : ì •ìƒ 0.102, ì´ìƒ 0.723

âš ï¸  ì˜¤íƒ (False Positive): 55ê°œ
   ì˜¤íƒë¥ : 11.51%

âŒ ë¯¸íƒ (False Negative): 57ê°œ
   ë¯¸íƒë¥ : 18.87%
```

### 4. ê²°ê³¼ íŒŒì¼

**íŒŒì¼**: `data/inference_results.csv`

**ë‚´ìš©**:
- ì›ë³¸ ë°ì´í„°
- ê° íƒì§€ê¸° ì ìˆ˜
- ì¢…í•© ì ìˆ˜
- ì˜ˆì¸¡ ë ˆì´ë¸”
- ì •ë‹µ ì—¬ë¶€

**ìƒ˜í”Œ**:
```csv
timestamp,endpoint_id,udp_echo_rtt_ms,ecpri_delay_us,label,rule_based_score,changepoint_score,residual_score,composite_score,predicted_label,correct
2025-10-15 12:00:00,o-ru-test-001,5.12,101.45,normal,0.05,0.03,0.08,0.053,normal,True
2025-10-15 12:30:00,o-ru-test-001,15.32,255.87,anomaly,0.65,0.72,0.78,0.717,anomaly,True
...
```

---

## ê²°ê³¼ ë¶„ì„

### 1. CSV íŒŒì¼ë¡œ ë¶„ì„

```bash
# ì²˜ìŒ 20ê°œ ê²°ê³¼ í™•ì¸
head -20 data/inference_results.csv

# ì´ìƒìœ¼ë¡œ ì˜ˆì¸¡ëœ ì¼€ì´ìŠ¤ë§Œ
grep "anomaly" data/inference_results.csv | head -10
```

### 2. Excelë¡œ ë¶„ì„

```bash
# Excelì—ì„œ ì—´ê¸°
open data/inference_results.csv  # macOS
xdg-open data/inference_results.csv  # Linux
```

### 3. Pythonìœ¼ë¡œ ë¶„ì„

```python
import pandas as pd

# ê²°ê³¼ ë¡œë“œ
df = pd.read_csv('data/inference_results.csv')

# ì˜¤íƒ ë¶„ì„ (False Positive)
false_positives = df[(df['label'] == 'normal') & (df['predicted_label'] == 'anomaly')]
print(f"ì˜¤íƒ: {len(false_positives)}ê°œ")
print(false_positives[['timestamp', 'udp_echo_rtt_ms', 'composite_score']])

# ë¯¸íƒ ë¶„ì„ (False Negative)
false_negatives = df[(df['label'] == 'anomaly') & (df['predicted_label'] == 'normal')]
print(f"ë¯¸íƒ: {len(false_negatives)}ê°œ")
print(false_negatives[['timestamp', 'udp_echo_rtt_ms', 'composite_score']])

# ì ìˆ˜ ë¶„í¬
import matplotlib.pyplot as plt
df.boxplot(column='composite_score', by='label')
plt.show()
```

### 4. ì„±ëŠ¥ ì§€í‘œ

| ì§€í‘œ | ê³„ì‚° ë°©ì‹ | ëª©í‘œ |
|------|----------|------|
| **ì •í™•ë„ (Accuracy)** | (TP + TN) / Total | > 85% |
| **ì •ë°€ë„ (Precision)** | TP / (TP + FP) | > 80% |
| **ì¬í˜„ìœ¨ (Recall)** | TP / (TP + FN) | > 80% |
| **F1 Score** | 2 Ã— (Precision Ã— Recall) / (Precision + Recall) | > 80% |
| **ì˜¤íƒë¥  (FPR)** | FP / (FP + TN) | < 15% |

- TP: True Positive (ì •í™•íˆ ì´ìƒ íƒì§€)
- TN: True Negative (ì •í™•íˆ ì •ìƒ íŒë‹¨)
- FP: False Positive (ì •ìƒì¸ë° ì´ìƒìœ¼ë¡œ ì˜¤íƒ)
- FN: False Negative (ì´ìƒì¸ë° ì •ìƒìœ¼ë¡œ ë¯¸íƒ)

---

## ì „ì²´ ì›Œí¬í”Œë¡œìš° ìš”ì•½

### ğŸ“‹ ì²´í¬ë¦¬ìŠ¤íŠ¸

```bash
# 1. ë°ì´í„° ìƒì„±
python scripts/generate_training_inference_data.py
# âœ… data/training_normal_only.csv (í•™ìŠµìš©)
# âœ… data/inference_test_scenarios.csv (ì¶”ë¡ ìš©)

# 2. ëª¨ë¸ í•™ìŠµ
./scripts/train_all_models.sh
# âœ… ocad/models/tcn/udp_echo_v1.0.0.pth
# âœ… ocad/models/tcn/ecpri_v1.0.0.pth
# âœ… ocad/models/tcn/lbm_v1.0.0.pth

# 3. ì¶”ë¡  í…ŒìŠ¤íŠ¸
python scripts/test_inference.py
# âœ… data/inference_results.csv

# 4. ê²°ê³¼ ë¶„ì„
head -20 data/inference_results.csv
```

### ğŸ¯ í•µì‹¬ í¬ì¸íŠ¸

1. **í•™ìŠµ**: ì •ìƒ ë°ì´í„°ë§Œ ì‚¬ìš© âœ…
2. **ì¶”ë¡ **: ì •ìƒ + ë¹„ì •ìƒ ëª¨ë‘ í…ŒìŠ¤íŠ¸ âœ“
3. **í‰ê°€**: ì˜¤íƒë¥ /ë¯¸íƒë¥  í™•ì¸ ğŸ“Š
4. **ê°œì„ **: ì„ê³„ê°’ ì¡°ì •, ëª¨ë¸ ì¬í•™ìŠµ ğŸ”„

---

## ìì£¼ ë¬»ëŠ” ì§ˆë¬¸ (FAQ)

### Q1. ì™œ ì •ìƒ ë°ì´í„°ë¡œë§Œ í•™ìŠµí•˜ë‚˜ìš”?

**A**: ì´ìƒ íƒì§€ì˜ íŠ¹ì„±ìƒ:
- ì •ìƒ íŒ¨í„´ì€ ì˜ˆì¸¡ ê°€ëŠ¥
- ì´ìƒ íŒ¨í„´ì€ ë‹¤ì–‘í•˜ê³  ì˜ˆì¸¡ ë¶ˆê°€
- í•™ìŠµ ì‹œ ë³¸ ì  ì—†ëŠ” ìƒˆë¡œìš´ ì´ìƒë„ íƒì§€ ê°€ëŠ¥

### Q2. ë¹„ì •ìƒ ë°ì´í„°ê°€ í•„ìš” ì—†ë‚˜ìš”?

**A**: í•™ìŠµì—ëŠ” ë¶ˆí•„ìš”, í‰ê°€ì—ëŠ” í•„ìš”:
- **í•™ìŠµ**: ì •ìƒë§Œ âœ…
- **í‰ê°€**: ì •ìƒ + ë¹„ì •ìƒ âœ“

### Q3. ëª¨ë¸ ì„±ëŠ¥ì´ ë‚®ìœ¼ë©´?

**A**: ë‹¤ìŒì„ ì‹œë„:
1. í•™ìŠµ ë°ì´í„° ì–‘ ì¦ê°€
2. í•™ìŠµ ì—í­ ìˆ˜ ì¦ê°€
3. ì„ê³„ê°’ ì¡°ì •
4. ë‹¤ë¥¸ ëª¨ë¸ ì•„í‚¤í…ì²˜ ì‹œë„

### Q4. ì˜¤íƒì´ ë§ìœ¼ë©´?

**A**: ì„ê³„ê°’ì„ ë†’ì´ê¸°:
```python
# test_inference.pyì—ì„œ
predicted_label = "anomaly" if composite_score > 0.7 else "normal"
# ê¸°ë³¸ê°’ 0.5 â†’ 0.7ë¡œ ë³€ê²½
```

### Q5. ë¯¸íƒì´ ë§ìœ¼ë©´?

**A**: ì„ê³„ê°’ì„ ë‚®ì¶”ê¸°:
```python
predicted_label = "anomaly" if composite_score > 0.3 else "normal"
# ê¸°ë³¸ê°’ 0.5 â†’ 0.3ìœ¼ë¡œ ë³€ê²½
```

---

## ì°¸ê³  ë¬¸ì„œ

- [Model-Training-Guide.md](Model-Training-Guide.md) - ëª¨ë¸ í•™ìŠµ ìƒì„¸ ê°€ì´ë“œ
- [Training-Inference-Separation-Design.md](Training-Inference-Separation-Design.md) - í•™ìŠµ-ì¶”ë¡  ë¶„ë¦¬ ì„¤ê³„
- [Quick-Start-Guide.md](Quick-Start-Guide.md) - ë¹ ë¥¸ ì‹œì‘ ê°€ì´ë“œ

---

**ì‘ì„±ì**: Claude Code
**ë‚ ì§œ**: 2025-10-23
**ë²„ì „**: 1.0.0
